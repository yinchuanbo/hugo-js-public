<!DOCTYPE html>






























<html
  class="not-ready text-sm lg:text-base"
  style="--bg: #fff"
  lang="en"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  
  <title>获取上传进度的几种方式 - 灏天阁</title>

  
  <meta name="theme-color" />
  
  <meta name="description" content="前端使用 axios 实现监听上传进度 咱们先使用axios实现监听上传进度如下：
axios .post(&#34;/api/file/uploadfile&#34;, form, { headers: { &#34;Content-Type&#34;: &#34;multipart/form-data&#34;, }, onUploadProgress: (progressEvent) =&gt; { if (progressEvent.lengthComputable) { this.progresss = Math.round( (progressEvent.loaded / progressEvent.total) * 100 ); } }, }) .then((res) =&gt; { // ... }); 前端使用ajax获取上传进度 前端使用ajax如何获取上传进度呢？ 如下：
const xhr = new XMLHttpRequest(); xhr.upload.addEventListener(&#34;progress&#34;, (event) =&gt; { if (event.lengthComputable) { const progressPercentage = Math.round((event.loaded / event.total) * 100); console.log(`上传进度: ${progressPercentage}%`); } }); 前端使用fetch API获取上传进度 如何使用fetch API获取上传的进度呢？如下：
const file = document." />
  <meta name="author" content="" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="/main.min.css" />

  

  
  
  
    
  
  <link
    rel="preload"
    as="image"
    href="/theme.png"
  />

  
  
  
  <link rel="preload" as="image" href="/imgs/logo.png" />
  
  

  

  
  <link rel="icon" href="/img/ico.ico" />
  <link rel="apple-touch-icon" href="/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.108.0">

  
  

  
  
  
  
  
  
  
  
  
  <meta property="og:title" content="获取上传进度的几种方式" />
<meta property="og:description" content="前端使用 axios 实现监听上传进度 咱们先使用axios实现监听上传进度如下：
axios .post(&#34;/api/file/uploadfile&#34;, form, { headers: { &#34;Content-Type&#34;: &#34;multipart/form-data&#34;, }, onUploadProgress: (progressEvent) =&gt; { if (progressEvent.lengthComputable) { this.progresss = Math.round( (progressEvent.loaded / progressEvent.total) * 100 ); } }, }) .then((res) =&gt; { // ... }); 前端使用ajax获取上传进度 前端使用ajax如何获取上传进度呢？ 如下：
const xhr = new XMLHttpRequest(); xhr.upload.addEventListener(&#34;progress&#34;, (event) =&gt; { if (event.lengthComputable) { const progressPercentage = Math.round((event.loaded / event.total) * 100); console.log(`上传进度: ${progressPercentage}%`); } }); 前端使用fetch API获取上传进度 如何使用fetch API获取上传的进度呢？如下：
const file = document." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/101/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-20T21:07:24+08:00" />
<meta property="article:modified_time" content="2024-01-20T21:07:24+08:00" />

  
  <meta itemprop="name" content="获取上传进度的几种方式">
<meta itemprop="description" content="前端使用 axios 实现监听上传进度 咱们先使用axios实现监听上传进度如下：
axios .post(&#34;/api/file/uploadfile&#34;, form, { headers: { &#34;Content-Type&#34;: &#34;multipart/form-data&#34;, }, onUploadProgress: (progressEvent) =&gt; { if (progressEvent.lengthComputable) { this.progresss = Math.round( (progressEvent.loaded / progressEvent.total) * 100 ); } }, }) .then((res) =&gt; { // ... }); 前端使用ajax获取上传进度 前端使用ajax如何获取上传进度呢？ 如下：
const xhr = new XMLHttpRequest(); xhr.upload.addEventListener(&#34;progress&#34;, (event) =&gt; { if (event.lengthComputable) { const progressPercentage = Math.round((event.loaded / event.total) * 100); console.log(`上传进度: ${progressPercentage}%`); } }); 前端使用fetch API获取上传进度 如何使用fetch API获取上传的进度呢？如下：
const file = document."><meta itemprop="datePublished" content="2024-01-20T21:07:24+08:00" />
<meta itemprop="dateModified" content="2024-01-20T21:07:24+08:00" />
<meta itemprop="wordCount" content="393">
<meta itemprop="keywords" content="" />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="获取上传进度的几种方式"/>
<meta name="twitter:description" content="前端使用 axios 实现监听上传进度 咱们先使用axios实现监听上传进度如下：
axios .post(&#34;/api/file/uploadfile&#34;, form, { headers: { &#34;Content-Type&#34;: &#34;multipart/form-data&#34;, }, onUploadProgress: (progressEvent) =&gt; { if (progressEvent.lengthComputable) { this.progresss = Math.round( (progressEvent.loaded / progressEvent.total) * 100 ); } }, }) .then((res) =&gt; { // ... }); 前端使用ajax获取上传进度 前端使用ajax如何获取上传进度呢？ 如下：
const xhr = new XMLHttpRequest(); xhr.upload.addEventListener(&#34;progress&#34;, (event) =&gt; { if (event.lengthComputable) { const progressPercentage = Math.round((event.loaded / event.total) * 100); console.log(`上传进度: ${progressPercentage}%`); } }); 前端使用fetch API获取上传进度 如何使用fetch API获取上传的进度呢？如下：
const file = document."/>

  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    
    <header
  class="mx-auto flex h-[5rem] max-w-3xl px-8 lg:justify-center"
  style="position: relative;align-items: end;height: 6rem;"
>
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="wb-title -translate-x-[1px] -translate-y-0.5 text-3xl font-bold top__header"
      href="/"
      >灏天阁</a
    >
    
  </div>

  <a
    class="btn-menu relative z-50 -mr-8 flex h-[5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
  ></a>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = `"#fff"`.replace(/"/g, '');
    const setDark = (isDark) => {
      isDark = true;
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    const darkVal = localStorage.getItem('dark');
    setDark(darkVal ? darkVal === 'true' : darkScheme.matches);

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    
    
    
    
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
  </div>
</header>


    
    <main
      class="pb-custom prose prose-neutral relative mx-auto min-h-[calc(100%-10rem)] max-w-3xl px-8 pt-20 dark:prose-invert"
      style="z-index: 10; padding-top: 0;"
      id="main"
    >
      

<article>
  <header class="mb-10">
    <h1 class="!my-0 pb-2.5">获取上传进度的几种方式</h1>

    
    <div class="text-sm opacity-60" style="margin-top: 0.5em">
      
      <time>Jan 20, 2024</time>
      
      
      <span class="mx-1">&middot;</span>
      <span>Yin灏</span>
    </div>
    
  </header>

  <section><h3 id="前端使用-axios-实现监听上传进度">前端使用 axios 实现监听上传进度</h3>
<blockquote>
<p>咱们先使用<code>axios</code>实现监听上传进度如下：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">axios</span>
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">post</span>(<span style="color:#e6db74">&#34;/api/file/uploadfile&#34;</span>, <span style="color:#a6e22e">form</span>, {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">headers</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>      <span style="color:#e6db74">&#34;Content-Type&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;multipart/form-data&#34;</span>,
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">onUploadProgress</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">progressEvent</span>) =&gt; {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">progressEvent</span>.<span style="color:#a6e22e">lengthComputable</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">this</span>.<span style="color:#a6e22e">progresss</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">round</span>(
</span></span><span style="display:flex;"><span>          (<span style="color:#a6e22e">progressEvent</span>.<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">progressEvent</span>.<span style="color:#a6e22e">total</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>        );
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">res</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  });
</span></span></code></pre></div><h3 id="前端使用ajax获取上传进度">前端使用<code>ajax</code>获取上传进度</h3>
<blockquote>
<p>前端使用<code>ajax</code>如何获取上传进度呢？ 如下：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">xhr</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XMLHttpRequest</span>();
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">xhr</span>.<span style="color:#a6e22e">upload</span>.<span style="color:#a6e22e">addEventListener</span>(<span style="color:#e6db74">&#34;progress&#34;</span>, (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">lengthComputable</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">progressPercentage</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">round</span>((<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">total</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`上传进度: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">progressPercentage</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%`</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div><h3 id="前端使用fetch-api获取上传进度">前端使用<code>fetch API</code>获取上传进度</h3>
<blockquote>
<p>如何使用<code>fetch API</code>获取上传的进度呢？如下：</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">file</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;fileInput&#34;</span>).<span style="color:#a6e22e">files</span>[<span style="color:#ae81ff">0</span>];
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">fetch</span>(<span style="color:#e6db74">&#34;/upload&#34;</span>, {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">method</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;POST&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">body</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">file</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">onprogress</span><span style="color:#f92672">:</span> (<span style="color:#a6e22e">event</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">lengthComputable</span>) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">progressPercentage</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">round</span>((<span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">loaded</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">event</span>.<span style="color:#a6e22e">total</span>) <span style="color:#f92672">*</span> <span style="color:#ae81ff">100</span>);
</span></span><span style="display:flex;"><span>      <span style="color:#a6e22e">console</span>.<span style="color:#a6e22e">log</span>(<span style="color:#e6db74">`上传进度: </span><span style="color:#e6db74">${</span><span style="color:#a6e22e">progressPercentage</span><span style="color:#e6db74">}</span><span style="color:#e6db74">%`</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>})
</span></span><span style="display:flex;"><span>  .<span style="color:#a6e22e">then</span>((<span style="color:#a6e22e">response</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 处理响应结果
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  })
</span></span><span style="display:flex;"><span>  .<span style="color:#66d9ef">catch</span>((<span style="color:#a6e22e">error</span>) =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// 处理错误
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  });
</span></span></code></pre></div><h3 id="多文件上传展示一个进度条">多文件上传展示一个进度条</h3>
<blockquote>
<p>如果支持多个文件上传，并已文件上传个数展示进度条的话，一般都是怎么做的呢？</p>
</blockquote>
<ul>
<li>需要考虑多个文件比如 10 个文件，在你上传完第一个的时候进度条需要控制再 10%以下，依此类推。如下面一块代码：</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">progress</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">UPLOAD_TYPE_MAP</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">UPLOADING</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;uploading&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">COMPLATE</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;complate&#34;</span>,
</span></span><span style="display:flex;"><span>};
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">file</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">UPLOAD_TYPE_MAP</span>.<span style="color:#a6e22e">UPLOADING</span> },
</span></span><span style="display:flex;"><span>  { <span style="color:#a6e22e">file</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;&#34;</span>, <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">UPLOAD_TYPE_MAP</span>.<span style="color:#a6e22e">UPLOADING</span> },
</span></span><span style="display:flex;"><span>];
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">index</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">index</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span>; <span style="color:#a6e22e">index</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">element</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">files</span>[<span style="color:#a6e22e">index</span>];
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// 1、这里是调接口的逻辑，可以是并行也可以完成一个调下一个，这个看你们的接口的限速吧，我就按照并行做了。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#75715e">// 2、这里是每个文件上传完成的逻辑，更改当前文件的状态把status 改成UPLOAD_TYPE_MAP.COMPLATE
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">timer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setInterval</span>(() =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">eachProgress</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span>; <span style="color:#75715e">// 计算单个的比例
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">complateUpload</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UPLOAD_TYPE_MAP</span>.<span style="color:#a6e22e">COMPLATE</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">upperLimit</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">complateUpload</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">eachProgress</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">maxProgress</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">upperLimit</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">upperLimit</span>; <span style="color:#75715e">// 计算出当前最大进度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">progress</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">maxProgress</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">progress</span><span style="color:#f92672">++</span>; <span style="color:#75715e">// 边界控制
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">maxProgress</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">100</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">progress</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">clearInterval</span>(<span style="color:#a6e22e">time</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}, <span style="color:#ae81ff">500</span>);
</span></span></code></pre></div><blockquote>
<p>上面就多文件展示一个进度条的具体代码。其实不是很准确，文件有大有小，如果文件大小差不太多展示开可以。其实最好的方案是分别利用<code>axios</code>、<code>ajax</code>等分别展示一个进度条。还是看业务需求吧，</p>
</blockquote>
<h2 id="大文件分片上传展示进度条">大文件分片上传展示进度条</h2>
<blockquote>
<p>先简单说下分片上传的好处如下：</p>
</blockquote>
<ol>
<li>可靠性和鲁棒性：将大文件分成小块进行上传，即使出现网络中断或其他意外情况，只需要重新上传失败的分片，而不需要重新上传整个文件，提高上传的可靠性和鲁棒性。</li>
<li>传输效率：由于大文件被分成多个小块进行<strong>并行</strong>上传，可以充分利用网络带宽，提高传输速度和效率。</li>
<li>断点续传：如果上传过程中断，可以根据已成功上传的分片信息，从上次中断的地方继续上传，避免重复上传已经上传过的部分，节省时间和资源。</li>
<li>内存占用低：大文件一次性加载到内存中可能导致内存溢出，而分片上传只需加载单个分片，减少了对内存的压力，并适应内存有限的环境。</li>
<li>服务器负载平衡：使用分片上传可以将上传请求分散到多个服务器，降低单一服务器的负载压力，提高整体系统的稳定性和吞吐量。</li>
<li>灵活性：分片上传允许用户在任意时间暂停、取消或恢复上传过程，提供了更好的用户体验和操作灵活性。</li>
</ol>
<p>其实像咱们经常说别的网站为啥有的上传速度这么快，我用的网速一样我的为啥这么慢。其实还有就是看你们上传的文件大小有没有必要做分片上传，毕竟没有直接一个接口上传开发快，前端、服务端都需要增加工作成本。那咱们下面先看下怎么实现分片如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#75715e">// 定义分片大小（以字节为单位） // 1MB
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// 将文件切割为多个分片
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">function</span> <span style="color:#a6e22e">sliceFileIntoChunks</span>(<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">chunkSize</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">1024</span> <span style="color:#f92672">*</span> <span style="color:#ae81ff">1024</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileSize</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">size</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chunks</span> <span style="color:#f92672">=</span> Math.<span style="color:#a6e22e">ceil</span>(<span style="color:#a6e22e">fileSize</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">chunkSize</span>);
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">fileChunks</span> <span style="color:#f92672">=</span> [];
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> <span style="color:#a6e22e">end</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">chunkSize</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">let</span> <span style="color:#a6e22e">i</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; <span style="color:#a6e22e">i</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">chunks</span>; <span style="color:#a6e22e">i</span><span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">chunk</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">file</span>.<span style="color:#a6e22e">slice</span>(<span style="color:#a6e22e">start</span>, <span style="color:#a6e22e">end</span>); <span style="color:#75715e">// slice 可以把文件按照需要的大小分割
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#a6e22e">fileChunks</span>.<span style="color:#a6e22e">push</span>(<span style="color:#a6e22e">chunk</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">start</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">end</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">end</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">start</span> <span style="color:#f92672">+</span> <span style="color:#a6e22e">chunkSize</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">fileChunks</span>;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>获取上传进度（这个需求又回到了【多文件上传展示一个进度条】上面）如下：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">files</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">sliceFileIntoChunks</span>(<span style="color:#a6e22e">originFile</span>).<span style="color:#a6e22e">map</span>((<span style="color:#a6e22e">item</span>) =&gt; ({
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">file</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">item</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">status</span><span style="color:#f92672">:</span> <span style="color:#a6e22e">UPLOAD_TYPE_MAP</span>.<span style="color:#a6e22e">UPLOADING</span>,
</span></span><span style="display:flex;"><span>}));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// ... 忽略
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">timer</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">setInterval</span>(() =&gt; {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">eachProgress</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">/</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">length</span>; <span style="color:#75715e">// 计算单个的比例
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">complateUpload</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">files</span>.<span style="color:#a6e22e">filter</span>(
</span></span><span style="display:flex;"><span>    (<span style="color:#a6e22e">item</span>) =&gt; <span style="color:#a6e22e">item</span>.<span style="color:#a6e22e">status</span> <span style="color:#f92672">===</span> <span style="color:#a6e22e">UPLOAD_TYPE_MAP</span>.<span style="color:#a6e22e">COMPLATE</span>
</span></span><span style="display:flex;"><span>  );
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">upperLimit</span> <span style="color:#f92672">=</span> (<span style="color:#a6e22e">complateUpload</span>.<span style="color:#a6e22e">length</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">eachProgress</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">const</span> <span style="color:#a6e22e">maxProgress</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">upperLimit</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">?</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">:</span> <span style="color:#a6e22e">upperLimit</span>; <span style="color:#75715e">// 计算出当前最大进度
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">progress</span> <span style="color:#f92672">&lt;</span> <span style="color:#a6e22e">maxProgress</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">progress</span><span style="color:#f92672">++</span>; <span style="color:#75715e">// 边界控制
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  }
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">maxProgress</span> <span style="color:#f92672">===</span> <span style="color:#ae81ff">100</span>) {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">progress</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>;
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">clearInterval</span>(<span style="color:#a6e22e">time</span>);
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}, <span style="color:#ae81ff">500</span>);
</span></span></code></pre></div><p><strong>有一个点需要注意你要告诉服务端你得切片索引，后面服务端还要合并切片呢！！！</strong>。还有如果你们是按照大小切割的比如<code>1M</code>，你还要再上传完成给<strong>服务端发送一个合并切片的通知</strong>。 如果你们是以份额切分的每次就分为 10 等份，那么这个上传完成的请求你不再通知服务端也能判断上。</p>
</section>

  
  

  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a class="flex w-1/2 items-center p-6 pr-3 no-underline" href="/posts/102/"
      ><span class="mr-1.5">←</span><span>使用音频和视频</span></a
    >
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end p-6 pl-3 no-underline"
      href="/posts/100/"
      ><span>Set 和 WeakSet 的用法和区别</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  

  
  
</article>


    </main>

    <div class="book__list">
      <h2 class="book__list_title">- Book Lists -</h2>
      <ul>
        <li>1. Node.js / Python / Docker</li>
        <li>2. Express / Koa2 / Egg</li>
        <li>3. Node爬虫 / chrome扩展</li>
        <li>4. Vue3.3 / TypeScript5.0</li>
        <li>5. React1.8</li>
        <li>6. Angular14.0.5</li>
        <li>7. MySQL / MongDB</li>
        <li>8. Uniapp / Taro</li>
        <li>9. 异常监控并上报</li>
        <li>10. 自动化测试 / 单元测试</li>
        <li>11. Vite / Webpack / Babel</li>
        <li>12. 数据可视化Echats / 大屏</li>
        <li>13. 工程化 / 自动化部署</li>
        <li>14. Scss / TailwindCss</li>
        <li>15. ElementUI / Antd Design</li>
      </ul>
      
    </div>

    <footer
  class="opaco mx-auto flex h-[5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
  style="position: relative; z-index: 10"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="/">灏天阁</a>
  </div>
  <a class="link" href="https://yinchuanbo.github.io/" rel="noopener" target="_blank"
    >Powered by YinHao</a
  >️ ▷
</footer>


    
  </body>
</html>
